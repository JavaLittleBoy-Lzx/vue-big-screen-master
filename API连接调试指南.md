# APIè¿æ¥è°ƒè¯•æŒ‡å—

## é—®é¢˜è¯Šæ–­

æ ¹æ®ä½ æåˆ°çš„é—®é¢˜ï¼š
1. å‰ç«¯æ•°æ®æ²¡æœ‰è¿æ¥åç«¯
2. ç»Ÿè®¡é‡Œæ²¡æœ‰"1å·é—¨å…¥å£"è¿™ç±»æ•°æ®
3. éœ€è¦è¡¨æ ¼æ»šåŠ¨åŠŸèƒ½

## ä¸€ã€å·²å®Œæˆçš„ä¿®å¤

### 1. æ·»åŠ è¯¦ç»†æ—¥å¿—è¾“å‡º âœ…

ç°åœ¨å‰ç«¯ä¼šåœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†çš„APIè°ƒç”¨æ—¥å¿—ï¼š

```javascript
ğŸš€ [äººè„¸æ•°æ®] å¼€å§‹è¯·æ±‚API...
ğŸ“¡ [äººè„¸æ•°æ®] APIå“åº”: {...}
ğŸ“¦ [äººè„¸æ•°æ®] å“åº”æ•°æ®: {...}
âœ… [äººè„¸æ•°æ®] è·å–åˆ° X ä¸ªé€šé“æ•°æ®
ğŸ“Š [äººè„¸æ•°æ®] é€šé“åˆ—è¡¨: [...]
ğŸ” [äººè„¸æ•°æ®] å¤„ç†é€šé“: XXX
```

### 2. æ·»åŠ è¡¨æ ¼æ»šåŠ¨åŠŸèƒ½ âœ…

- è¡¨æ ¼å†…å®¹åŒºåŸŸå¯å‚ç›´æ»šåŠ¨
- è‡ªå®šä¹‰è“è‰²æ»šåŠ¨æ¡æ ·å¼
- è¡¨å¤´å›ºå®šä¸æ»šåŠ¨

## äºŒã€è°ƒè¯•æ­¥éª¤

### æ­¥éª¤1ï¼šæ£€æŸ¥åç«¯æœåŠ¡

ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼š

```bash
# æ£€æŸ¥ç«¯å£8085æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr "8085"
```

**æˆ–è€…åœ¨æµè§ˆå™¨è®¿é—®ï¼š**
```
http://localhost:8085/parking/analysis/face/channel-statistics?timeRange=today
```

### æ­¥éª¤2ï¼šæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

1. æ‰“å¼€å¤§å±é¡µé¢
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Consoleï¼ˆæ§åˆ¶å°ï¼‰** æ ‡ç­¾
4. æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—ï¼š

**æˆåŠŸæƒ…å†µï¼š**
```
ğŸš€ [äººè„¸æ•°æ®] å¼€å§‹è¯·æ±‚API...
ğŸ“¡ [äººè„¸æ•°æ®] APIå“åº”: {data: {...}, status: 200}
ğŸ“¦ [äººè„¸æ•°æ®] å“åº”æ•°æ®: {code: 200, data: {...}}
âœ… [äººè„¸æ•°æ®] è·å–åˆ° 5 ä¸ªé€šé“æ•°æ®
ğŸ“Š [äººè„¸æ•°æ®] é€šé“åˆ—è¡¨: ["1å·é—¨å…¥å£", "2å·é—¨å…¥å£", ...]
```

**å¤±è´¥æƒ…å†µA - åç«¯æœªå¯åŠ¨ï¼š**
```
ğŸš€ [äººè„¸æ•°æ®] å¼€å§‹è¯·æ±‚API...
âŒ [äººè„¸æ•°æ®] åŠ è½½é€šé“æ•°æ®å¤±è´¥: Network Error
ğŸš« [äººè„¸æ•°æ®] é”™è¯¯è¯¦æƒ…: Network Error
ğŸ”„ [äººè„¸æ•°æ®] åˆ‡æ¢åˆ°æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼
```

**å¤±è´¥æƒ…å†µB - æ•°æ®ä¸ºç©ºï¼š**
```
ğŸš€ [äººè„¸æ•°æ®] å¼€å§‹è¯·æ±‚API...
ğŸ“¡ [äººè„¸æ•°æ®] APIå“åº”: {data: {...}, status: 200}
ğŸ“¦ [äººè„¸æ•°æ®] å“åº”æ•°æ®: {code: 200, data: {channels: []}}
âš ï¸ [äººè„¸æ•°æ®] åç«¯è¿”å›çš„é€šé“æ•°æ®ä¸ºç©ºï¼Œåˆ‡æ¢åˆ°æ¨¡æ‹Ÿæ•°æ®
```

## ä¸‰ã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šåç«¯æœåŠ¡æœªå¯åŠ¨

**ç—‡çŠ¶ï¼š**
```
âŒ [äººè„¸æ•°æ®] åŠ è½½é€šé“æ•°æ®å¤±è´¥: Network Error
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. å¯åŠ¨åç«¯æœåŠ¡
2. ç¡®è®¤ç«¯å£8085å¯è®¿é—®

### é—®é¢˜2ï¼šæ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ®

**ç—‡çŠ¶ï¼š**
```
âš ï¸ [äººè„¸æ•°æ®] åç«¯è¿”å›çš„é€šé“æ•°æ®ä¸ºç©º
```

**è§£å†³æ–¹æ¡ˆï¼š**

#### æ–¹æ¡ˆAï¼šæ£€æŸ¥acms_event_recordè¡¨æ•°æ®

```sql
-- æŸ¥è¯¢è¡¨ä¸­æ˜¯å¦æœ‰æ•°æ®
SELECT COUNT(*) FROM acms_event_record WHERE deleted = 0;

-- æŸ¥è¯¢æœ‰å“ªäº›é€šé“
SELECT DISTINCT channel_name, COUNT(*) as count 
FROM acms_event_record 
WHERE deleted = 0 
  AND event_time >= DATE_FORMAT(NOW(), '%Y-%m-%d 00:00:00')
GROUP BY channel_name;
```

å¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œè¯´æ˜æ•°æ®åº“ä¸­æ²¡æœ‰ä»Šå¤©çš„æ•°æ®ã€‚

#### æ–¹æ¡ˆBï¼šæ’å…¥æµ‹è¯•æ•°æ®

```sql
-- æ’å…¥æµ‹è¯•æ•°æ®ï¼ˆ1å·é—¨å…¥å£ï¼‰
INSERT INTO acms_event_record (
  event_id, event_type, recognition_type, person_id, person_name, 
  organization, channel_name, direction, event_time, create_time, update_time, deleted
) VALUES 
('TEST001', 196893, 'äººè„¸è¯†åˆ«', 'P001', 'å¼ ä¸‰', 
 'é»˜è®¤ç»„ç»‡/é‡ç”ŸåŠ¨ç‰©ä¸è‡ªç„¶ä¿æŠ¤åœ°å­¦é™¢/å­¦ç”Ÿ/ç¡•å£«/2024æ—ä¸š1', 
 '1å·é—¨å…¥å£', 'è¿›', NOW(), NOW(), NOW(), 0),
('TEST002', 196893, 'äººè„¸è¯†åˆ«', 'P002', 'æå››', 
 'é»˜è®¤ç»„ç»‡/ç»æµç®¡ç†å­¦é™¢/æ•™å¸ˆ/å‰¯æ•™æˆ', 
 '1å·é—¨å…¥å£', 'å‡º', NOW(), NOW(), NOW(), 0),
('TEST003', 196893, 'äººè„¸è¯†åˆ«', 'P003', 'ç‹äº”', 
 'é»˜è®¤ç»„ç»‡/æ—ä¸šå­¦é™¢/å­¦ç”Ÿ/æœ¬ç§‘/2023çº§', 
 '2å·é—¨å…¥å£', 'è¿›', NOW(), NOW(), NOW(), 0);

-- æ’å…¥æ›´å¤šæµ‹è¯•æ•°æ®ï¼ˆå¾ªç¯æ’å…¥100æ¡ï¼‰
-- å¯ä»¥é€šè¿‡åç«¯æ¥å£æˆ–æ•°æ®åº“è„šæœ¬æ‰¹é‡æ’å…¥
```

#### æ–¹æ¡ˆCï¼šä¿®æ”¹åç«¯é€»è¾‘è¿”å›æ¨¡æ‹Ÿæ•°æ®

å¦‚æœæš‚æ—¶æ— æ³•è·å–çœŸå®æ•°æ®ï¼Œå¯ä»¥ä¿®æ”¹åç«¯åœ¨æ•°æ®ä¸ºç©ºæ—¶è¿”å›æ¨¡æ‹Ÿæ•°æ®ï¼š

åœ¨ `FaceAnalysisController.java` çš„ `calculateChannelStatistics` æ–¹æ³•ä¸­ï¼š

```java
if (eventRecords == null || eventRecords.isEmpty()) {
    log.info("ğŸ“­ [é€šé“äººæµç»Ÿè®¡] æ•°æ®åº“æ•°æ®ä¸ºç©ºï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®");
    // ä¸è¦ç›´æ¥è¿”å›ç©ºï¼Œè€Œæ˜¯è¿”å›æ¨¡æ‹Ÿæ•°æ®
    return getMockChannelStatistics();
}
```

### é—®é¢˜3ï¼šè·¨åŸŸé—®é¢˜

**ç—‡çŠ¶ï¼š**
```
Access to XMLHttpRequest at 'http://localhost:8085/...' from origin 'http://localhost:8080' 
has been blocked by CORS policy
```

**è§£å†³æ–¹æ¡ˆï¼š**

æ£€æŸ¥åç«¯æ˜¯å¦é…ç½®äº†CORSï¼š

```java
@Configuration
public class CorsConfig {
    @Bean
    public CorsFilter corsFilter() {
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedOrigin("http://localhost:8080");
        config.addAllowedOrigin("http://127.0.0.1:8080");
        config.setAllowCredentials(true);
        config.addAllowedMethod("*");
        config.addAllowedHeader("*");
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);
        
        return new CorsFilter(source);
    }
}
```

## å››ã€éªŒè¯APIæ˜¯å¦æ­£å¸¸

### æ–¹æ³•1ï¼šä½¿ç”¨Postmanæµ‹è¯•

1. æ‰“å¼€Postman
2. åˆ›å»ºGETè¯·æ±‚ï¼š`http://localhost:8085/parking/analysis/face/channel-statistics?timeRange=today`
3. ç‚¹å‡» **Send**
4. æ£€æŸ¥å“åº”ï¼š

**æœŸæœ›å“åº”ï¼š**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "channels": [
      {
        "name": "1å·é—¨å…¥å£",
        "totalCount": 123,
        "countData": [10, 20, 30, ...],
        "typeDistribution": [
          {"name": "å­¦ç”Ÿ", "value": 56, "percent": 45},
          {"name": "æ•™èŒå·¥", "value": 34, "percent": 28},
          ...
        ]
      }
    ],
    "timeRange": "today",
    "dataSource": "DATABASE"
  }
}
```

### æ–¹æ³•2ï¼šä½¿ç”¨curlå‘½ä»¤

```bash
curl -X GET "http://localhost:8085/parking/analysis/face/channel-statistics?timeRange=today"
```

### æ–¹æ³•3ï¼šæµè§ˆå™¨ç›´æ¥è®¿é—®

åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š
```
http://localhost:8085/parking/analysis/face/channel-statistics?timeRange=today
```

## äº”ã€è¡¨æ ¼æ»šåŠ¨åŠŸèƒ½ä½¿ç”¨

è¡¨æ ¼ç°åœ¨æ”¯æŒæ»šåŠ¨æ˜¾ç¤ºï¼š

- **å‚ç›´æ»šåŠ¨**ï¼šå½“é€šé“æ•°æ®è¶…è¿‡5æ¡æ—¶ï¼Œè¡¨æ ¼ä¼šå‡ºç°æ»šåŠ¨æ¡
- **è‡ªå®šä¹‰æ»šåŠ¨æ¡**ï¼šè“è‰²æ¸å˜æ»šåŠ¨æ¡ï¼Œæ‚¬åœæ—¶åŠ æ·±
- **è¡¨å¤´å›ºå®š**ï¼šæ»šåŠ¨æ—¶è¡¨å¤´ä¿æŒå›ºå®š

**CSSå®ç°ï¼š**
```scss
.table-scroll-wrapper {
  flex: 1;
  overflow-y: auto;      // å‚ç›´æ»šåŠ¨
  overflow-x: hidden;    // ç¦æ­¢æ¨ªå‘æ»šåŠ¨
  
  /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
  &::-webkit-scrollbar {
    width: 8px;
  }
  
  &::-webkit-scrollbar-thumb {
    background: rgba(0, 229, 255, 0.3);  // è“è‰²åŠé€æ˜
    &:hover {
      background: rgba(0, 229, 255, 0.5);  // æ‚¬åœæ—¶åŠ æ·±
    }
  }
}
```

## å…­ã€å®Œæ•´æµ‹è¯•æµç¨‹

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd d:\nefu-edu-datav\boot-new-20251112
mvn spring-boot:run
```

æˆ–è€…åœ¨IDEä¸­ç›´æ¥è¿è¡ŒApplicationä¸»ç±»ã€‚

### 2. éªŒè¯åç«¯API

æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:8085/parking/analysis/face/channel-statistics?timeRange=today
```

å¦‚æœçœ‹åˆ°JSONæ•°æ®è¿”å›ï¼Œè¯´æ˜åç«¯æ­£å¸¸ã€‚

### 3. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd d:\nefu-edu-datav\vue-big-screen-master
npm run serve
```

### 4. æ‰“å¼€å¤§å±é¡µé¢

æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:8080
```

### 5. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—

æŒ‰ `F12` æ‰“å¼€æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š

- å¦‚æœçœ‹åˆ° `âœ… [äººè„¸æ•°æ®] è·å–åˆ° X ä¸ªé€šé“æ•°æ®`ï¼Œè¯´æ˜è¿æ¥æˆåŠŸ
- å¦‚æœçœ‹åˆ° `âŒ` æˆ– `âš ï¸`ï¼Œè¯´æ˜æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯

### 6. éªŒè¯æ•°æ®æ˜¾ç¤º

- æ£€æŸ¥è¡¨æ ¼æ˜¯å¦æ˜¾ç¤ºçœŸå®çš„é€šé“åç§°ï¼ˆå¦‚"1å·é—¨å…¥å£"ï¼‰
- ç‚¹å‡»å›¾è¡¨æŸ¥çœ‹è¯¦æƒ…å¼¹çª—
- æµ‹è¯•è¡¨æ ¼æ»šåŠ¨åŠŸèƒ½

## ä¸ƒã€ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœæš‚æ—¶æ— æ³•è¿æ¥åç«¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼š

```javascript
// æ¨¡æ‹Ÿçš„é€šé“æ•°æ®
const channels = [
  { id: 1, name: '1å·é—¨å…¥å£', icon: 'ğŸšª', type: 'in' },
  { id: 2, name: '2å·é—¨å…¥å£', icon: 'ğŸšª', type: 'in' },
  { id: 3, name: '3å·é—¨å…¥å£', icon: 'ğŸšª', type: 'in' },
  { id: 4, name: '1å·é—¨å‡ºå£', icon: 'ğŸšª', type: 'out' },
  { id: 5, name: '2å·é—¨å‡ºå£', icon: 'ğŸšª', type: 'out' },
];
```

æ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
```
ğŸ”„ [äººè„¸æ•°æ®] åˆ‡æ¢åˆ°æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼
```

## å…«ã€è”ç³»æ”¯æŒ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»ç„¶æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°å®Œæ•´æ—¥å¿—**ï¼ˆåŒ…å«æ‰€æœ‰ `[äººè„¸æ•°æ®]` ç›¸å…³æ—¥å¿—ï¼‰
2. **åç«¯APIæµ‹è¯•ç»“æœ**ï¼ˆPostmanæˆ–curlçš„å“åº”ï¼‰
3. **æ•°æ®åº“æŸ¥è¯¢ç»“æœ**ï¼ˆé€šé“æ•°æ®ç»Ÿè®¡ï¼‰
4. **é”™è¯¯æˆªå›¾**

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š** 2025-01-17

**é—®é¢˜çŠ¶æ€ï¼š** 
- âœ… å·²æ·»åŠ è¯¦ç»†æ—¥å¿—
- âœ… å·²æ·»åŠ è¡¨æ ¼æ»šåŠ¨
- â³ ç­‰å¾…éªŒè¯APIè¿æ¥
