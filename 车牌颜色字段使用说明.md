# 车牌颜色字段使用说明

## 功能概述

车辆监控中心现在可以直接使用后端数据库中的 `enter_car_license_color` 和 `exit_car_license_color` 字段来判断车牌颜色，并显示对应的车牌样式。

## 支持的车牌颜色及样式

系统支持以下四种车牌颜色，每种颜色对应不同的车牌样式：

| 数据库颜色值 | 英文值 | 车牌样式 | 背景色 | 文字色 | 说明 |
|------------|--------|---------|-------|--------|------|
| 蓝色 | blue | traditional | 蓝底 | 白字 | 普通小型汽车 |
| 绿色 | green | new-energy | 绿底 | 黑字 | 新能源汽车 |
| 黄色 | yellow | yellow | 黄底 | 黑字 | 大型车辆 |
| 白色 | white | police | 白底 | 黑字 | 警车等特殊车辆 |

## 数据字段说明

### 后端数据库字段
- `enter_car_license_color`: 进场车辆的车牌颜色
- `exit_car_license_color`: 出场车辆的车牌颜色
- `enter_car_type`: 进场车辆类型（备用字段，当颜色字段不可用时使用）

### 前端数据传递
系统会自动从后端数据中提取这些字段，并在以下位置使用：
1. 车辆监控中心顶部大图的车牌显示
2. 车辆实时数据表格中的车牌号码显示
3. 通道弹窗中的车牌号码显示

## 判断逻辑

`getPlateType()` 方法会按以下优先级判断车牌类型：

1. **优先使用颜色字段**：检查 `enter_car_license_color` 或 `exit_car_license_color` 字段
2. **降级方案1**：如果车牌以"警"结尾，识别为警车
3. **降级方案2**：如果 `enter_car_type` 为 "2"，识别为黄牌
4. **降级方案3**：根据车牌长度判断（8位为新能源，7位为传统车牌）

## 修改的文件

### `center.vue`

#### 1. 数据映射方法
- `mapAndNormalizeRecords()`: 添加了车牌颜色字段的映射
- `addPolledRecord()`: 在格式化记录时保留颜色字段

#### 2. 车牌类型判断方法
- `getPlateType()`: 优先使用颜色字段判断车牌类型

#### 3. 通道快照更新方法
- `updateChannelSnapshot()`: 保存车牌颜色字段到通道快照
- `updateChannelSnapshotFromFormatted()`: 从格式化记录更新时保留颜色字段
- `initializeChannelSnapshotsFromRecords()`: 初始化通道快照时包含颜色字段

#### 4. 车辆相机数据更新
在以下位置更新 `currentVehicleCamera` 时都包含了颜色字段：
- 初始化车辆记录时
- 轮询获取新记录时
- 从通道快照更新时

## 样式定义

车牌样式定义在 `center.vue` 的 `<style>` 部分：

```scss
.plate-number.traditional {
  background: linear-gradient(180deg, #0C4FC5 0%, #216FEF 100%);
  color: #FFFFFF;
  border: 1px solid #0C4FC5;
  box-shadow: 0 2px 4px rgba(12, 79, 197, 0.3);
}

.plate-number.new-energy {
  background: linear-gradient(180deg, #6AD390 0%, #D0F1E4 100%);
  color: #000000;
  border: 1px solid #6AD390;
  box-shadow: 0 2px 4px rgba(106, 211, 144, 0.3);
}

.plate-number.yellow {
  background: linear-gradient(180deg, #f8c401 0%, #dba700 100%);
  color: #111;
  border: 1px solid #a88600;
  box-shadow: 0 2px 4px rgba(220,176,20,0.15);
}

.plate-number.police {
  background: linear-gradient(180deg, #f5f5f5 0%, #e0e0e0 100%);
  color: #222;
  border: 1px solid #adadad;
  box-shadow: 0 2px 4px rgba(120,120,120,0.14);
}
```

## 测试建议

1. **测试不同颜色的车牌**：
   - 蓝色车牌（普通小型汽车）
   - 绿色车牌（新能源汽车）
   - 黄色车牌（大型车辆）
   - 白色车牌（警车等）

2. **测试数据缺失情况**：
   - 后端未返回颜色字段时，系统应使用降级方案
   - 颜色字段为空时，系统应使用车牌长度判断

3. **测试显示位置**：
   - 车辆监控中心顶部大图
   - 车辆实时数据表格
   - 通道弹窗

## 注意事项

1. **兼容性**：系统保留了降级方案，即使后端未返回颜色字段，仍能正常显示车牌
2. **颜色格式**：系统同时支持中文（蓝色、绿色、黄色、白色）和英文（blue, green, yellow, white）格式
3. **大小写不敏感**：颜色判断时会自动转换为小写，不受大小写影响
4. **数据传递**：确保后端API返回的数据中包含 `enter_car_license_color` 或 `exit_car_license_color` 字段

## 更新日期

2025-10-25

## 相关文件

- `src/views/center.vue` - 主要修改文件
- `src/services/vehicleDataService.js` - 数据服务（需要确保返回颜色字段）

