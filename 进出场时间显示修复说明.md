# è¿›å‡ºåœºæ—¶é—´æ˜¾ç¤ºä¿®å¤è¯´æ˜

## ä¿®å¤çš„é—®é¢˜

### é—®é¢˜1ï¼šè¿›åœºæ—¶é—´å’Œç¦»åœºæ—¶é—´æ˜¾ç¤ºä¸º `-`ï¼ˆç©ºæ•°æ®ï¼‰
**åŸå› **ï¼šå‰ç«¯è§£æJSONæ ¼å¼é”™è¯¯
- åç«¯è¿”å›çš„æ˜¯**æ•°ç»„æ ¼å¼**ï¼š`[{"enterTime":"...","leaveTime":"..."}]`
- å‰ç«¯é”™è¯¯åœ°è§£æä¸º**å¯¹è±¡æ ¼å¼**ï¼Œå¹¶ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µåï¼ˆ`entryTime`/`exitTime`ï¼‰
- æ­£ç¡®çš„å­—æ®µååº”è¯¥æ˜¯ï¼š`enterTime`/`leaveTime`

### é—®é¢˜2ï¼šæ–°èƒ½æºè½¦ç‰Œæ˜¾ç¤ºä¸ºè“è‰²
**åŸå› **ï¼šæœªåŒºåˆ†æ™®é€šè½¦ç‰Œå’Œæ–°èƒ½æºè½¦ç‰Œ
- æ–°èƒ½æºè½¦ç‰Œæ˜¯8ä½ï¼ˆä¾‹å¦‚ï¼šé²A12345Dï¼‰
- æ™®é€šè½¦ç‰Œæ˜¯7ä½ï¼ˆä¾‹å¦‚ï¼šé»‘A5Y33ï¼‰
- éœ€è¦æ ¹æ®é•¿åº¦åˆ¤æ–­å¹¶åº”ç”¨ä¸åŒé¢œè‰²

## ä¿®å¤å†…å®¹

### æ–‡ä»¶
`d:/nefu-edu-datav/vue-big-screen-master/src/views/VisitorPlanDashboard.vue`

### 1. ä¿®å¤è¿›å‡ºåœºæ—¶é—´è§£æï¼ˆç¬¬599-637è¡Œï¼‰

#### ä¿®å¤å‰ï¼ˆé”™è¯¯ä»£ç ï¼‰
```javascript
getEntryTime(item) {
  const timesJson = this.modalType === 'vehicle' ? item.carVisitTimes : item.personVisitTimes;
  if (!timesJson) return '-';
  
  try {
    const times = JSON.parse(timesJson);
    if (times && times.entryTime) {  // âŒ é”™è¯¯1: å°†æ•°ç»„å½“å¯¹è±¡å¤„ç†
      return this.formatTime(times.entryTime);  // âŒ é”™è¯¯2: å­—æ®µåé”™è¯¯
    }
  } catch (e) {
    console.error('è§£æè¿›åœºæ—¶é—´å¤±è´¥:', e);
  }
  return '-';
}
```

#### ä¿®å¤åï¼ˆæ­£ç¡®ä»£ç ï¼‰
```javascript
getEntryTime(item) {
  const timesJson = this.modalType === 'vehicle' ? item.carVisitTimes : item.personVisitTimes;
  if (!timesJson) return '-';
  
  try {
    const times = JSON.parse(timesJson);
    // âœ… times æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå–ç¬¬ä¸€ä¸ªå…ƒç´ 
    if (Array.isArray(times) && times.length > 0 && times[0].enterTime) {
      return this.formatTime(times[0].enterTime);  // âœ… æ­£ç¡®çš„å­—æ®µå
    }
  } catch (e) {
    console.error('è§£æè¿›åœºæ—¶é—´å¤±è´¥:', e, timesJson);  // æ·»åŠ åŸå§‹æ•°æ®æ—¥å¿—
  }
  return '-';
}
```

**å…³é”®ä¿®å¤**ï¼š
- âœ… ä½¿ç”¨ `Array.isArray(times)` åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
- âœ… è®¿é—® `times[0]` è·å–ç¬¬ä¸€ä¸ªå…ƒç´ 
- âœ… ä½¿ç”¨æ­£ç¡®çš„å­—æ®µå `enterTime` å’Œ `leaveTime`
- âœ… æ·»åŠ åŸå§‹JSONæ•°æ®åˆ°æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•

### 2. æ·»åŠ æ–°èƒ½æºè½¦ç‰Œåˆ¤æ–­æ–¹æ³•ï¼ˆç¬¬632-637è¡Œï¼‰

```javascript
// åˆ¤æ–­æ˜¯å¦ä¸ºæ–°èƒ½æºè½¦ç‰Œï¼ˆ8ä½ï¼‰
isNewEnergyPlate(carNumber) {
  if (!carNumber) return false;
  // æ–°èƒ½æºè½¦ç‰Œé€šå¸¸æ˜¯8ä½ï¼Œæ™®é€šè½¦ç‰Œæ˜¯7ä½
  return carNumber.length >= 8;
}
```

### 3. ä¿®æ”¹è½¦ç‰ŒHTMLæ·»åŠ åŠ¨æ€ç±»åï¼ˆç¬¬71-73è¡Œï¼‰

#### ä¿®å¤å‰
```vue
<td v-if="modalType === 'vehicle'">
  <span class="car-plate">{{ item.carNumber }}</span>
</td>
```

#### ä¿®å¤å
```vue
<td v-if="modalType === 'vehicle'">
  <span class="car-plate" :class="{ 'green-plate': isNewEnergyPlate(item.carNumber) }">
    {{ item.carNumber }}
  </span>
</td>
```

### 4. æ·»åŠ ç»¿è‰²è½¦ç‰ŒCSSæ ·å¼ï¼ˆç¬¬1029-1035è¡Œï¼‰

```scss
.car-plate {
  // ... è“è‰²è½¦ç‰Œé»˜è®¤æ ·å¼ ...
  
  // æ–°èƒ½æºè½¦ç‰Œï¼ˆç»¿è‰²ï¼‰
  &.green-plate {
    background: linear-gradient(135deg, #00c853 0%, #00a846 100%);
    box-shadow: 
      0 2px 8px rgba(0, 200, 83, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }
}
```

## æ•°æ®æ ¼å¼è¯´æ˜

### åç«¯è¿”å›çš„JSONæ ¼å¼

**äººå‘˜è¿›å‡ºåœºæ—¶é—´** (`personVisitTimes`):
```json
[
  {
    "enterTime": "2025-11-26 08:48:00",
    "leaveTime": "2025-11-26 21:35:00"
  }
]
```

**è½¦è¾†è¿›å‡ºåœºæ—¶é—´** (`carVisitTimes`):
```json
[
  {
    "enterTime": "2025-11-26 08:00:00",
    "leaveTime": "2025-11-26 18:00:00"
  }
]
```

**æ³¨æ„**ï¼š
- âœ… æ˜¯**æ•°ç»„æ ¼å¼**ï¼Œä¸æ˜¯å¯¹è±¡
- âœ… å­—æ®µåæ˜¯ `enterTime` å’Œ `leaveTime`
- âœ… æ—¶é—´æ ¼å¼ï¼š`yyyy-MM-dd HH:mm:ss`
- âŒ ä¸æ˜¯ `entryTime` å’Œ `exitTime`

### å‰ç«¯è§£ææ­¥éª¤

1. **è·å–JSONå­—ç¬¦ä¸²**
   ```javascript
   const timesJson = item.carVisitTimes;  // æˆ– item.personVisitTimes
   ```

2. **è§£æJSON**
   ```javascript
   const times = JSON.parse(timesJson);
   // times = [{"enterTime":"...","leaveTime":"..."}]
   ```

3. **è®¿é—®æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ **
   ```javascript
   const firstRecord = times[0];
   // firstRecord = {"enterTime":"...","leaveTime":"..."}
   ```

4. **è·å–æ—¶é—´å€¼**
   ```javascript
   const enterTime = firstRecord.enterTime;  // "2025-11-26 08:48:00"
   const leaveTime = firstRecord.leaveTime;  // "2025-11-26 21:35:00"
   ```

5. **æ ¼å¼åŒ–æ˜¾ç¤º**
   ```javascript
   this.formatTime(enterTime);  // "11-26 08:48"
   ```

## è½¦ç‰Œé¢œè‰²åˆ¤æ–­é€»è¾‘

### åˆ¤æ–­è§„åˆ™
```javascript
carNumber.length >= 8  â†’  æ–°èƒ½æºè½¦ç‰Œï¼ˆç»¿è‰²ï¼‰
carNumber.length < 8   â†’  æ™®é€šè½¦ç‰Œï¼ˆè“è‰²ï¼‰
```

### ç¤ºä¾‹

| è½¦ç‰Œå· | é•¿åº¦ | ç±»å‹ | é¢œè‰² |
|--------|------|------|------|
| é»‘A5Y33 | 6 | æ™®é€š | ğŸ”µ è“è‰² |
| é²A12345D | 8 | æ–°èƒ½æº | ğŸŸ¢ ç»¿è‰² |
| äº¬AD12345 | 8 | æ–°èƒ½æº | ğŸŸ¢ ç»¿è‰² |

### CSSæ ·å¼å¯¹æ¯”

**è“è‰²æ™®é€šè½¦ç‰Œ**ï¼š
```scss
background: linear-gradient(135deg, #1e90ff 0%, #0066cc 100%);
box-shadow: 0 2px 8px rgba(30, 144, 255, 0.4), ...;
```

**ç»¿è‰²æ–°èƒ½æºè½¦ç‰Œ**ï¼š
```scss
background: linear-gradient(135deg, #00c853 0%, #00a846 100%);
box-shadow: 0 2px 8px rgba(0, 200, 83, 0.4), ...;
```

## æµ‹è¯•æ­¥éª¤

### 1. å‡†å¤‡æµ‹è¯•æ•°æ®

ç¡®ä¿æ•°æ®åº“ä¸­æœ‰è¿›å‡ºåœºæ—¶é—´æ•°æ®ï¼š
```sql
-- æŸ¥çœ‹æ•°æ®
SELECT 
  id, 
  visitor_name, 
  car_number,
  person_visit_status,
  person_visit_times,
  car_visit_status,
  car_visit_times
FROM visitor_reservation_sync
WHERE person_visit_status LIKE '%å·²è¿›åœº%'
   OR car_visit_status LIKE '%å·²è¿›åœº%';
```

å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå¯ä»¥æ‰‹åŠ¨æ’å…¥ï¼š
```sql
-- æ›´æ–°äººå‘˜è¿›å‡ºåœºæ—¶é—´
UPDATE visitor_reservation_sync 
SET person_visit_times = '[{"enterTime":"2025-11-26 08:48:00","leaveTime":"2025-11-26 21:35:00"}]'
WHERE id = 1;

-- æ›´æ–°è½¦è¾†è¿›å‡ºåœºæ—¶é—´
UPDATE visitor_reservation_sync 
SET car_visit_times = '[{"enterTime":"2025-11-26 08:00:00","leaveTime":"2025-11-26 18:00:00"}]'
WHERE id = 6 AND car_number IS NOT NULL;
```

### 2. æµ‹è¯•è®¿å®¢è¯¦æƒ…

1. åˆ·æ–°é¡µé¢ï¼ˆå‰ç«¯çƒ­æ›´æ–°å·²ç”Ÿæ•ˆï¼‰
2. ç‚¹å‡»"è®¡åˆ’è®¿å®¢"æ°´æ³¢å›¾
3. æŸ¥çœ‹è¯¦æƒ…å¼¹çª—

**é¢„æœŸç»“æœ**ï¼š
| åºå· | è®¿å®¢å§“å | æ‰‹æœºå· | ... | è¿›åœºæ—¶é—´ | ç¦»åœºæ—¶é—´ | æ¥è®¿çŠ¶æ€ |
|------|----------|--------|-----|----------|----------|----------|
| 1    | é­å°˜å®—   | 186... | ... | 11-26 08:48 | 11-26 21:35 | äººå·²è¿›åœº |

### 3. æµ‹è¯•è½¦è¾†è¯¦æƒ…

1. ç‚¹å‡»"é¢„è®¡è½¦è¾†"æ°´æ³¢å›¾
2. æŸ¥çœ‹è¯¦æƒ…å¼¹çª—

**é¢„æœŸç»“æœ**ï¼š
| åºå· | è®¿å®¢å§“å | è½¦ç‰Œå· | ... | è¿›åœºæ—¶é—´ | ç¦»åœºæ—¶é—´ | æ¥è®¿çŠ¶æ€ |
|------|----------|--------|-----|----------|----------|----------|
| 1    | è°¢è€€å†›   | ğŸ”µé»‘A5Y33 | ... | 11-26 08:00 | 11-26 18:00 | è½¦å·²è¿›åœº |
| 2    | æä¸œæ˜   | ğŸŸ¢é²A12345D | ... | 11-26 09:00 | - | è½¦å·²è¿›åœº |

### 4. éªŒè¯è½¦ç‰Œé¢œè‰²

- âœ… 7ä½è½¦ç‰Œæ˜¾ç¤ºè“è‰²ï¼ˆä¾‹å¦‚ï¼šé»‘A5Y33ï¼‰
- âœ… 8ä½è½¦ç‰Œæ˜¾ç¤ºç»¿è‰²ï¼ˆä¾‹å¦‚ï¼šé²A12345Dï¼‰

### 5. æ£€æŸ¥æ§åˆ¶å°

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ï¼š
- âŒ ä¸åº”è¯¥æœ‰"è§£æè¿›åœºæ—¶é—´å¤±è´¥"é”™è¯¯
- âŒ ä¸åº”è¯¥æœ‰"è§£æç¦»åœºæ—¶é—´å¤±è´¥"é”™è¯¯
- âœ… åº”è¯¥æ­£å¸¸æ˜¾ç¤ºæ—¶é—´

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæ—¶é—´ä»ç„¶æ˜¾ç¤º `-`

**å¯èƒ½åŸå› **ï¼š
1. æ•°æ®åº“ä¸­ `person_visit_times` æˆ– `car_visit_times` å­—æ®µä¸ºç©º
2. JSONæ ¼å¼é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š
```sql
-- æ£€æŸ¥æ•°æ®
SELECT person_visit_times, car_visit_times 
FROM visitor_reservation_sync 
WHERE id = 1;
```

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®ä¿å­—æ®µå€¼æ˜¯æœ‰æ•ˆçš„JSONæ•°ç»„
- æ ¼å¼ï¼š`[{"enterTime":"...","leaveTime":"..."}]`

### é—®é¢˜2ï¼šè½¦ç‰Œé¢œè‰²ä¸æ­£ç¡®

**å¯èƒ½åŸå› **ï¼š
1. è½¦ç‰Œé•¿åº¦è®¡ç®—é”™è¯¯
2. CSSæ ·å¼æœªåŠ è½½

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. æ£€æŸ¥è½¦ç‰Œå…ƒç´ çš„class
3. åº”è¯¥æœ‰ `car-plate` å’Œ `green-plate`ï¼ˆå¦‚æœæ˜¯8ä½ï¼‰

### é—®é¢˜3ï¼šæµè§ˆå™¨ç¼“å­˜é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡¬åˆ·æ–°ï¼šCtrl + F5
2. æ¸…é™¤ç¼“å­˜ï¼šCtrl + Shift + Delete
3. æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•

## è°ƒè¯•æŠ€å·§

### 1. æ·»åŠ è°ƒè¯•æ—¥å¿—

åœ¨ `getEntryTime` æ–¹æ³•ä¸­æ·»åŠ æ—¥å¿—ï¼š
```javascript
getEntryTime(item) {
  const timesJson = this.modalType === 'vehicle' ? item.carVisitTimes : item.personVisitTimes;
  console.log('ğŸ“‹ åŸå§‹JSON:', timesJson);
  
  if (!timesJson) return '-';
  
  try {
    const times = JSON.parse(timesJson);
    console.log('âœ… è§£æå:', times);
    console.log('ğŸ” ç¬¬ä¸€æ¡è®°å½•:', times[0]);
    
    if (Array.isArray(times) && times.length > 0 && times[0].enterTime) {
      const time = this.formatTime(times[0].enterTime);
      console.log('â° æ ¼å¼åŒ–æ—¶é—´:', time);
      return time;
    }
  } catch (e) {
    console.error('âŒ è§£æå¤±è´¥:', e, timesJson);
  }
  return '-';
}
```

### 2. æ£€æŸ¥ç½‘ç»œè¯·æ±‚

1. æ‰“å¼€å¼€å‘è€…å·¥å…· Network æ ‡ç­¾
2. æ‰¾åˆ° `detail-list` è¯·æ±‚
3. æŸ¥çœ‹ Response å“åº”æ•°æ®
4. ç¡®è®¤ `personVisitTimes` å’Œ `carVisitTimes` å­—æ®µå€¼

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

å½“å‰å®ç°å·²ç»æ¯”è¾ƒé«˜æ•ˆï¼Œä½†å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **ç¼“å­˜è§£æç»“æœ**
   ```javascript
   computed: {
     parsedDetailList() {
       return this.detailList.map(item => ({
         ...item,
         parsedEntryTime: this.getEntryTime(item),
         parsedExitTime: this.getExitTime(item)
       }));
     }
   }
   ```

2. **ä½¿ç”¨è®¡ç®—å±æ€§**
   - é¿å…åœ¨æ¨¡æ¿ä¸­é‡å¤è°ƒç”¨æ–¹æ³•
   - åˆ©ç”¨Vueçš„ç¼“å­˜æœºåˆ¶

## ç›¸å…³æ–‡ä»¶

- **å‰ç«¯ç»„ä»¶**: `/src/views/VisitorPlanDashboard.vue`
- **åç«¯æ§åˆ¶å™¨**: `/src/main/java/com/parkingmanage/controller/VisitorPlanDashboardController.java`
- **å·¥å…·ç±»**: `/src/main/java/com/parkingmanage/util/VisitTimeUtils.java`

## ä¿®å¤å®Œæˆæ—¶é—´

2025-11-26 10:50

## æ€»ç»“

âœ… å·²ä¿®å¤è¿›å‡ºåœºæ—¶é—´æ˜¾ç¤ºé—®é¢˜ï¼ˆæ­£ç¡®è§£æJSONæ•°ç»„ï¼‰  
âœ… å·²ä¿®å¤æ–°èƒ½æºè½¦ç‰Œé¢œè‰²é—®é¢˜ï¼ˆç»¿è‰²æ˜¾ç¤ºï¼‰  
âœ… æ·»åŠ äº†è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ä¾¿äºè°ƒè¯•  
âœ… ä»£ç æ›´åŠ å¥å£®ï¼Œå¤„ç†äº†å„ç§è¾¹ç•Œæƒ…å†µ
