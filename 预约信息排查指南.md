# é¢„çº¦ä¿¡æ¯ä¸æ˜¾ç¤ºæ’æŸ¥æŒ‡å—

## é—®é¢˜ç°è±¡
äººè„¸ç›‘æ§è¯¦æƒ…è¡¨æ ¼ä¸­çš„"é¢„çº¦ä¿¡æ¯"åˆ—å…¨éƒ¨æ˜¾ç¤ºä¸º"-"

## æ’æŸ¥æ­¥éª¤

### 1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦é‡å¯ âœ…
ä¿®æ”¹åç«¯ä»£ç åå¿…é¡»é‡å¯Spring Bootåº”ç”¨ã€‚

```bash
# åœæ­¢å½“å‰æœåŠ¡
# é‡æ–°å¯åŠ¨æœåŠ¡
```

### 2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿— ğŸ”

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹Consoleæ ‡ç­¾é¡µä¸­çš„æ—¥å¿—ï¼š

#### æŸ¥æ‰¾APIè¯·æ±‚æ—¥å¿—
```
ğŸŒ [APIè¯·æ±‚] äººè„¸æ•°æ®: http://localhost:8675/parking/face-monitor/list
```

#### æŸ¥æ‰¾APIå“åº”æ—¥å¿—
```
ğŸ“¦ [APIå“åº”] åŸå§‹å“åº”: { code: "0", data: { records: [...] } }
ğŸ“¦ [APIå“åº”] ç¬¬ä¸€æ¡è®°å½•ç¤ºä¾‹: { personName: "...", reservationTimeRange: "...", ... }
```

#### æŸ¥æ‰¾é¢„çº¦ä¿¡æ¯è°ƒè¯•æ—¥å¿—
```
ğŸ” [é¢„çº¦ä¿¡æ¯è°ƒè¯•] {
  isReservedVisitor: true/false,
  isPureVisitor: true/false,
  reservationTimeRange: "...",
  reservationFormName: "...",
  reservationCarPlate: "...",
  åŸå§‹æ•°æ®: { ... }
}
```

**å¦‚æœè¿™äº›å­—æ®µéƒ½æ˜¯ `null` æˆ–ç©ºå­—ç¬¦ä¸²ï¼Œè¯´æ˜æ•°æ®åº“ä¸­æ²¡æœ‰é¢„çº¦æ•°æ®ã€‚**

### 3. æ£€æŸ¥æ•°æ®åº“å­—æ®µ ğŸ—„ï¸

**å­—æ®µæ˜ å°„å…³ç³»**ï¼š
- `reservation_time_range` â†’ é¢„çº¦æ—¶é—´æ®µ
- `vip_type_name` â†’ è¡¨å•åç§°ï¼ˆé¢„çº¦è¡¨å•ï¼‰
- `plate_number` â†’ è½¦ç‰Œå·ç ï¼ˆè®¿å®¢æºå¸¦çš„è½¦ç‰Œï¼‰

è¿æ¥åˆ°MySQLæ•°æ®åº“ï¼Œæ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š

```sql
-- æ£€æŸ¥acms_event_recordè¡¨ç»“æ„
DESC acms_event_record;

-- æŸ¥çœ‹æ˜¯å¦æœ‰é¢„çº¦æ•°æ®
SELECT 
    person_name,
    reservation_time_range,
    vip_type_name,
    plate_number,
    event_type,
    event_time
FROM acms_event_record
WHERE reservation_time_range IS NOT NULL
   OR vip_type_name IS NOT NULL
   OR plate_number IS NOT NULL
LIMIT 10;

-- ç»Ÿè®¡é¢„çº¦æ•°æ®
SELECT 
    COUNT(*) as total_records,
    COUNT(reservation_time_range) as has_time_range,
    COUNT(vip_type_name) as has_vip_type,
    COUNT(plate_number) as has_plate_number
FROM acms_event_record;
```

**é¢„æœŸç»“æœ**ï¼š
- å¦‚æœ `has_time_range`ã€`has_vip_type`ã€`has_plate_number` éƒ½æ˜¯ 0ï¼Œè¯´æ˜æ•°æ®åº“ä¸­æ²¡æœ‰é¢„çº¦ä¿¡æ¯

### 4. æ£€æŸ¥ACMSæ¨é€æ•°æ® ğŸ“¡

é¢„çº¦ä¿¡æ¯éœ€è¦åœ¨ACMSæ¨é€äº‹ä»¶æ•°æ®æ—¶å¡«å……ã€‚æ£€æŸ¥ACMSæ¨é€çš„æ•°æ®æ˜¯å¦åŒ…å«é¢„çº¦ä¿¡æ¯ï¼š

```sql
-- æŸ¥çœ‹æœ€è¿‘çš„ACMSäº‹ä»¶è®°å½•
SELECT 
    id,
    person_name,
    event_time,
    event_type,
    reservation_time_range,
    raw_data
FROM acms_event_record
ORDER BY event_time DESC
LIMIT 10;
```

æŸ¥çœ‹ `raw_data` å­—æ®µä¸­æ˜¯å¦åŒ…å«é¢„çº¦ç›¸å…³çš„JSONæ•°æ®ã€‚

### 5. æµ‹è¯•æ•°æ®æ’å…¥ ğŸ§ª

å¦‚æœæ•°æ®åº“ä¸­ç¡®å®æ²¡æœ‰é¢„çº¦æ•°æ®ï¼Œå¯ä»¥æ‰‹åŠ¨æ’å…¥æµ‹è¯•æ•°æ®ï¼š

```sql
-- æ’å…¥æµ‹è¯•æ•°æ®ï¼ˆé¢„çº¦è®¿å®¢ï¼‰
UPDATE acms_event_record
SET 
    reservation_time_range = '2025-11-25 14:00:00-2025-11-25 16:00:00',
    vip_type_name = 'è®¿å®¢é¢„çº¦ç”³è¯·',
    plate_number = 'äº¬A12345'
WHERE id = (
    SELECT id FROM acms_event_record 
    WHERE event_type = 197162  -- äººè¯æ¯”å¯¹
    ORDER BY event_time DESC 
    LIMIT 1
);

-- éªŒè¯æ›´æ–°
SELECT 
    person_name,
    reservation_time_range,
    vip_type_name,
    plate_number
FROM acms_event_record
WHERE reservation_time_range IS NOT NULL
LIMIT 1;
```

æ›´æ–°åï¼Œåˆ·æ–°å‰ç«¯é¡µé¢ï¼Œåº”è¯¥èƒ½çœ‹åˆ°è¯¥æ¡è®°å½•æ˜¾ç¤ºé¢„çº¦ä¿¡æ¯ã€‚

### 6. æ£€æŸ¥APIå“åº”æ ¼å¼ ğŸ“„

åœ¨æµè§ˆå™¨æ§åˆ¶å°çš„Networkæ ‡ç­¾é¡µä¸­ï¼š

1. æ‰¾åˆ° `face-monitor/list` è¯·æ±‚
2. ç‚¹å‡»æŸ¥çœ‹Response
3. ç¡®è®¤è¿”å›æ•°æ®ä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
   ```json
   {
     "code": "0",
     "data": {
       "records": [
         {
           "personName": "å¼ ä¸‰",
           "isReservedVisitor": true,
           "isPureVisitor": false,
           "reservationTimeRange": "2025-11-25 14:00:00-2025-11-25 16:00:00",
           "reservationFormName": "è®¿å®¢é¢„çº¦ç”³è¯·",
           "reservationCarPlate": "äº¬A12345",
           "phoneNo": "138****5678",
           "idNumber": "110101********1234",
           ...
         }
       ],
       "total": 100,
       "page": 1,
       "size": 20
     }
   }
   ```

## é¢„æœŸè¡Œä¸º

### é¢„çº¦è®¿å®¢
- **æ¡ä»¶**ï¼š`isReservedVisitor = true`
- **æ˜¾ç¤º**ï¼š`æ—¶é—´ï¼š2025-11-25 14:00:00-2025-11-25 16:00:00 | è¡¨å•ï¼šè®¿å®¢é¢„çº¦ç”³è¯· | è½¦ç‰Œï¼šäº¬A12345`
- **æ ·å¼**ï¼šç»¿è‰²èƒŒæ™¯ï¼Œå·¦ä¾§ç»¿è‰²è¾¹æ¡†

### çº¯è®¿å®¢
- **æ¡ä»¶**ï¼š`isPureVisitor = true`ï¼ˆevent_type = 197162 ä¸”æ— é¢„çº¦ä¿¡æ¯ï¼‰
- **æ˜¾ç¤º**ï¼š`çº¯è®¿å®¢ï¼ˆæœªé¢„çº¦ï¼‰`
- **æ ·å¼**ï¼šæ©™è‰²èƒŒæ™¯ï¼Œå·¦ä¾§æ©™è‰²è¾¹æ¡†

### å…¶ä»–äººå‘˜
- **æ¡ä»¶**ï¼šéè®¿å®¢ï¼ˆæ•™èŒå·¥ã€å­¦ç”Ÿç­‰ï¼‰
- **æ˜¾ç¤º**ï¼š`-`
- **æ ·å¼**ï¼šç°è‰²æ–‡å­—

## å¸¸è§é—®é¢˜

### Q1: æ‰€æœ‰è®°å½•éƒ½æ˜¾ç¤º"-"
**åŸå› **ï¼šæ•°æ®åº“ä¸­ `reservation_time_range`ã€`vip_type_name`ã€`plate_number` å­—æ®µéƒ½æ˜¯NULL

**è§£å†³**ï¼š
1. æ£€æŸ¥ACMSæ¨é€æ•°æ®æ˜¯å¦åŒ…å«é¢„çº¦ä¿¡æ¯
2. æ£€æŸ¥ `AcmsVipController` çš„ `eventRcv` æ–¹æ³•æ˜¯å¦æ­£ç¡®è§£æå¹¶ä¿å­˜é¢„çº¦ä¿¡æ¯
3. ä½¿ç”¨æµ‹è¯•æ•°æ®éªŒè¯åŠŸèƒ½

### Q2: åç«¯è¿”å›æ•°æ®ä¸­å­—æ®µä¸ºnull
**åŸå› **ï¼šå®ä½“ç±»ä¸­æ²¡æœ‰å¯¹åº”çš„getteræ–¹æ³•ï¼Œæˆ–è€…å­—æ®µåä¸åŒ¹é…

**è§£å†³**ï¼š
1. ç¡®è®¤ `AcmsEventRecord.java` ä¸­æœ‰ `vipTypeName` å’Œ `plateNumber` å­—æ®µ
2. ç¡®è®¤ä½¿ç”¨äº† `@Data` æ³¨è§£æˆ–æ‰‹åŠ¨æ·»åŠ äº†getteræ–¹æ³•
3. æ•°æ®åº“å­—æ®µååº”ä¸º `vip_type_name` å’Œ `plate_number`ï¼ˆå·²å­˜åœ¨ï¼‰

### Q3: å‰ç«¯æ˜¾ç¤ºundefined
**åŸå› **ï¼šå‰ç«¯å­—æ®µåå’Œåç«¯è¿”å›çš„ä¸åŒ¹é…

**è§£å†³**ï¼šæ£€æŸ¥ `transformDetailData` æ–¹æ³•ä¸­çš„å­—æ®µæ˜ å°„æ˜¯å¦æ­£ç¡®

## éªŒè¯æ¸…å•

- [ ] åç«¯æœåŠ¡å·²é‡å¯
- [ ] æµè§ˆå™¨å·²åˆ·æ–°ï¼ˆCtrl+Shift+R å¼ºåˆ¶åˆ·æ–°ï¼‰
- [ ] æ§åˆ¶å°æ²¡æœ‰JavaScripté”™è¯¯
- [ ] Networkä¸­APIè¿”å›200çŠ¶æ€ç 
- [ ] APIå“åº”ä¸­åŒ…å«é¢„çº¦ç›¸å…³å­—æ®µ
- [ ] æ•°æ®åº“ä¸­æœ‰é¢„çº¦æ•°æ®
- [ ] å®ä½“ç±»åŒ…å«æ–°å¢å­—æ®µ

## ä¸‹ä¸€æ­¥

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ­£å¸¸ï¼Œä½†ä»ç„¶ä¸æ˜¾ç¤ºï¼š

1. æˆªå›¾æ§åˆ¶å°æ—¥å¿—ï¼ˆåŒ…æ‹¬ ğŸ” é¢„çº¦ä¿¡æ¯è°ƒè¯• çš„å®Œæ•´è¾“å‡ºï¼‰
2. æˆªå›¾Networkä¸­çš„APIå“åº”
3. æä¾›æ•°æ®åº“æŸ¥è¯¢ç»“æœ
