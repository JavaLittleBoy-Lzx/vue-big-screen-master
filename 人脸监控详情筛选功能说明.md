# 人脸监控详情筛选功能增强说明

## 更新时间
2025-11-25

## 功能概述
在人脸监控详情弹窗中新增了多个筛选条件，并优化了数据展示，增加了预约信息的显示。

## 一、新增筛选条件

### 1. 基础信息筛选
- **姓名**：支持模糊搜索
- **手机号**：支持模糊搜索
- **身份证号**：支持模糊搜索

### 2. 分类筛选
- **人员类型**：下拉选择
  - 全部类型
  - 预约访客
  - 未预约访客
  - 教职工
  - 学生

- **是否预约**：下拉选择
  - 全部
  - 预约访客（有预约时间段且有预约表单）
  - 纯访客（没有预约信息且通过人证比对进入）

- **学院/部门**：支持模糊搜索

- **门禁通道**：下拉选择（动态加载实际通道列表）

### 3. 时间筛选
- 今日
- 昨日
- 本周
- 本月
- 今年
- 自定义时间范围

## 二、数据展示优化

### 1. 新增表格列
在原有列的基础上新增：
- **手机号**：显示访客或人员的手机号
- **预约信息**：智能显示预约相关信息

### 2. 预约信息展示规则

#### 预约访客（绿色标识）
显示内容包括：
- 预约时间段（如：2025-01-15 10:00:00-2025-01-15 12:00:00）
- 预约表单名称
- 携带车牌号

显示格式：`时间：xxx | 表单：xxx | 车牌：xxx`

#### 纯访客（橙色标识）
- 通过人证比对进入
- 没有预约记录
显示内容：`纯访客（未预约）`

#### 其他人员（灰色）
- 教职工、学生等
显示内容：`-`

### 3. 样式说明
- **预约访客**：绿色背景，左侧绿色边框
- **纯访客**：橙色背景，左侧橙色边框
- **无预约信息**：灰色文字

## 三、后端接口改进

### 接口路径
`GET /parking/face-monitor/list`

### 新增请求参数
```javascript
{
  personName: '',      // 姓名（模糊查询）
  phoneNo: '',         // 手机号（模糊查询）
  idNumber: '',        // 身份证号（模糊查询）
  personType: '',      // 人员类型（精确匹配）
  isReserved: '',      // 是否预约（true/false）
  organization: '',    // 组织机构/学院（模糊查询）
  channel: '',         // 通道名称（精确匹配）
  direction: '',       // 方向：进/出
  startDate: '',       // 开始时间
  endDate: '',         // 结束时间
  page: 1,            // 页码
  size: 20            // 每页条数
}
```

### 新增响应字段
```javascript
{
  records: [
    {
      personName: '',              // 姓名
      channelName: '',             // 通道名称
      personType: '',              // 人员类型
      department: '',              // 部门/学院
      recognitionMethod: '',       // 识别方式
      phoneNo: '',                 // 手机号
      idNumber: '',                // 身份证号
      
      // 预约相关字段
      isReservedVisitor: false,    // 是否为预约访客
      isPureVisitor: false,        // 是否为纯访客
      reservationTimeRange: '',    // 预约时间段
      reservationFormName: '',     // 预约表单名称
      reservationCarPlate: '',     // 预约携带车牌号
      
      eventTime: ''                // 事件时间
    }
  ],
  total: 100,
  page: 1,
  size: 20,
  pages: 5
}
```

## 四、数据库字段

### acms_event_record 表新增字段
```sql
-- 预约表单名称
reservation_form_name VARCHAR(100) COMMENT '预约表单名称（访客预约的申请表单名称）';

-- 预约携带车牌号
reservation_car_plate VARCHAR(20) COMMENT '预约携带车牌号（访客预约时填写的车牌号）';
```

## 五、使用场景

### 场景1：查找预约访客
1. 点击"人脸进场"或"人脸出场"KPI卡片打开详情
2. 在"是否预约"下拉框选择"预约访客"
3. 可进一步输入姓名、手机号等条件精确查找
4. 查看预约时间、表单名称、携带车牌等详细信息

### 场景2：筛选纯访客
1. 打开人脸详情弹窗
2. 在"是否预约"下拉框选择"纯访客"
3. 系统筛选出所有通过人证比对进入但没有预约的访客

### 场景3：按学院查询
1. 在"学院/部门"输入框输入学院名称（如：计算机学院）
2. 系统自动模糊匹配相关人员
3. 可结合其他条件进一步筛选

### 场景4：按手机号或身份证号查询
1. 在对应输入框输入手机号或身份证号
2. 支持部分匹配
3. 快速定位特定人员的进出记录

## 六、技术实现

### 前端实现
- **文件**：`d:\nefu-edu-datav\vue-big-screen-master\src\views\center.vue`
- **主要改动**：
  - 新增筛选表单字段
  - 更新表格列配置
  - 添加预约信息处理逻辑
  - 新增样式类

### 后端实现
- **Controller**：`FaceMonitorController.java`
- **实体类**：`AcmsEventRecord.java`
- **主要改动**：
  - 扩展 `/list` 接口参数
  - 添加实体字段
  - 增强数据筛选逻辑
  - 添加预约信息判断

## 七、注意事项

1. **数据库迁移**：需要在 `acms_event_record` 表中添加新字段
2. **兼容性**：新字段均为可选，不影响现有数据
3. **性能优化**：建议为常用查询字段（如 `phone_no`、`id_card`）添加索引
4. **数据一致性**：预约信息需要在ACMS推送数据时正确填充

## 八、测试建议

1. **功能测试**
   - 测试各个筛选条件的单独使用
   - 测试多个条件的组合筛选
   - 验证预约信息的正确显示

2. **数据验证**
   - 验证预约访客的识别准确性
   - 验证纯访客的识别准确性
   - 检查时间段筛选的准确性

3. **界面测试**
   - 检查样式显示是否正常
   - 验证响应式布局
   - 测试大数据量下的性能

## 九、后续优化建议

1. 添加导出功能，支持导出筛选后的数据
2. 增加统计面板，显示预约访客、纯访客的数量占比
3. 支持保存常用筛选条件
4. 添加批量操作功能
5. 增加图表可视化展示
