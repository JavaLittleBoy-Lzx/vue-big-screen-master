## 1. 实时车辆动态分析
### 1.1 实时进出车辆监控
#### **使用的接口和字段：**
**3.1 进场数据同步接口**

+ `plate_number` - 车牌号码 (用于车辆识别和统计)
+ `entry_time` - 进场时间 (用于实时统计和时段分析)
+ `channel_id` - 通道ID (用于通道流量分析)
+ `parking_area` - 停车区域 (用于区域热度分析)
+ `vehicle_type` - 车辆类型 (普通/VIP车辆分类)
+ `entry_image` - 进场照片 (用于车辆识别验证)
+ `operator` - 操作员

**3.2 离场数据同步接口**

+ `plate_number` - 车牌号码
+ `exit_time` - 离场时间
+ `channel_id` - 离场通道
+ `parking_duration` - 停车时长 (分钟)
+ `parking_fee` - 停车费用
+ `exit_image` - 离场照片
+ `payment_status` - 支付状态 (已付/未付/免费)
+ `discount_applied` - 优惠券使用情况

**3.19 预进场上报接口**

+ `plate_number` - 预进场车牌
+ `pre_entry_time` - 预计进场时间
+ `channel_id` - 预计通道

**3.12 预离场上报接口**

+ `plate_number` - 预离场车牌
+ `pre_exit_time` - 预计离场时间

#### **数据分析方法：**
```javascript
// 实时车流统计
实时进场车流 = COUNT(entry_time >= 当前时间-5分钟)
// 统计最近5分钟内的进场车辆数量，用于实时监控停车场入口流量变化

小时进场量 = COUNT(entry_time BETWEEN 当前小时:00 AND 当前小时:59)
// 统计当前小时内的总进场车辆数，用于分析小时级别的流量分布

实时离场车流 = COUNT(exit_time >= 当前时间-5分钟)
// 统计最近5分钟内的离场车辆数量，监控出口流量和疏散效率

净增车流 = 进场车流 - 离场车流
// 计算停车场内车辆数量的净变化，正值表示车辆增加，负值表示减少

// 通道效率分析
通道流量排行 = GROUP BY channel_id, COUNT(*)
// 统计各个通道的总通行车辆数，识别使用频率最高和最低的通道

通道进场效率 = GROUP BY channel_id, COUNT(entry_time)
// 分析各进场通道的处理能力和使用情况，识别效率瓶颈

通道平均等待时间 = AVG(实际进场时间 - 预进场时间)
// 计算车辆从预约到实际进场的平均等待时长，评估通道服务质量

// 高峰时段分析
高峰时段分析 = GROUP BY HOUR(entry_time), COUNT(*) ORDER BY COUNT(*) DESC
// 按小时统计进场车辆数，识别一天中的流量高峰时段

离场高峰分析 = GROUP BY HOUR(exit_time), COUNT(*) ORDER BY COUNT(*) DESC
// 按小时统计离场车辆数，分析离场流量的时间分布规律

// 车辆类型统计
车辆类型进场统计 = GROUP BY vehicle_type, COUNT(*)
// 统计不同类型车辆（普通/VIP）的进场数量分布

区域进场热度 = GROUP BY parking_area, COUNT(*) ORDER BY COUNT(*) DESC
// 分析各停车区域的受欢迎程度，识别热门和冷门区域
```

#### **图表类型：**
**1. 实时数字大屏**：关键指标展示

+ **对应数据分析**：`实时进场车流`、`实时离场车流`、`净增车流`
+ **数据处理逻辑**：  
统计实时车流数据，包括进场车辆数、离场车辆数、净流量变化和当前小时累计进场量。建立三级预警机制：当净流量小于10辆时显示绿色正常状态，10-20辆间显示黄色警告状态，超过20辆时显示红色紧急状态。通过动态阈值设置，能够根据停车场容量和历史数据自动调整预警标准。
+ **配置参数**：
    - 数字字体大小：48px-72px
    - 刷新频率：5秒
    - 预警阈值：可配置的流量阈值
    - 动画效果：数字跳动和颜色渐变
+ **交互功能**：点击查看详细趋势，支持全屏显示

**2. 双轴柱状图**：进出场流量对比分析

+ **对应数据分析**：`小时进场量`、`通道进场效率`、`通道离场效率`
+ **数据处理逻辑**：  
按小时时间维度对进出场数据进行聚合统计，分别计算进场车辆数、离场车辆数，并按通道ID进行分组统计。通过计算进场率（进场车辆数除以总容量）、离场率（离场车辆数除以总容量）和平衡比率（进出场差值的绝对值除以最大值）来评估停车场的运营效率和流量平衡状况。
+ **配置参数**：
    - 左Y轴：进场车辆数（蓝色）
    - 右Y轴：离场车辆数（橙色）
    - 辅助线：净流量趋势线
    - 数据点：显示具体数值标签
+ **交互功能**：悬停显示详情，点击下钻到通道级别，支持时间范围筛选

**3. 流动曲线图**：实时车流动态监控

+ **对应数据分析**：`高峰时段分析`、`车辆类型进场统计`、`区域进场热度`
+ **数据处理逻辑**：  
建立实时数据流处理机制，维护进场数据、离场数据和VIP数据三个时间序列数组，默认保持最近50个数据点。每当有新数据到达时，会添加包含时间戳和数据值的新数据点，同时采用先进先出策略清理过期数据点，确保图表显示的流畅性和内存使用的合理性。支持动态调整最大数据点数量以适应不同的显示需求。
+ **配置参数**：
    - 采样间隔：30秒
    - 显示时长：最近25分钟
    - 平滑算法：Bezier曲线
    - 颜色配置：进场绿色、离场橙色、VIP金色
+ **交互功能**：缩放查看历史、标记异常时间点、预测趋势线

**4. 漏斗图**：停车流程转化分析

+ **对应数据分析**：`通道平均等待时间`、`预进场上报`、`支付状态分析`
+ **数据处理逻辑**：  
构建五阶段停车流程转化漏斗，包括预约进场、实际进场、正常停车、正常离场和完成支付五个关键节点。以预约进场为基准（转化率100%），逐层计算后续阶段的转化率，通过统计每个阶段的车辆数量并与基准数量对比，得出各阶段的转化率百分比。
+ **配置参数**：
    - 层级数量：5个关键节点
    - 颜色渐变：从深蓝到浅蓝
    - 标签显示：数量+转化率
    - 间距设置：突出流失环节

### 1.2 车位占用分析
#### **使用的接口和字段：**
**3.3 剩余车位同步接口**

+ `total_spaces` - 总车位数
+ `occupied_spaces` - 已占用车位
+ `available_spaces` - 剩余车位
+ `area_code` - 区域编码
+ `update_time` - 更新时间

**3.25 获取统计区域剩余车位数接口**

+ `area_name` - 区域名称
+ `total_spaces` - 总车位数
+ `occupied_spaces` - 已占用车位
+ `available_spaces` - 剩余车位
+ `utilization_rate` - 利用率

**3.5 获取在场车辆接口**

+ `plate_number` - 在场车牌
+ `entry_time` - 进场时间
+ `parking_area` - 停车区域

#### **数据分析方法：**
```javascript
// 车位利用率计算
车位利用率 = (occupied_spaces / total_spaces) * 100%
// 计算停车场整体或分区域的车位使用率，反映空间资源利用效率
// 利用率过高（>90%）表示接近饱和，需要启动限流或引导措施
// 利用率过低（<60%）表示资源浪费，可考虑调整收费或推广策略

区域利用率 = GROUP BY area_code, AVG(occupied_spaces / total_spaces)
// 分析各个停车区域的平均利用率，识别热门区域和冷门区域

车位周转率 = (每日进场次数 / 总车位数)
// 衡量车位使用频率和流动性，反映停车场的商业活跃度
// 高周转率表示车位使用效率高，适合短时停车需求
// 低周转率可能适合长时停车或需要提升服务吸引力

// 区域热度分析
区域热度 = GROUP BY parking_area, COUNT(在场车辆)
// 统计各区域当前停放的车辆数量，直观反映区域受欢迎程度

区域利用率排行 = GROUP BY area_name, AVG(utilization_rate) ORDER BY AVG(utilization_rate) DESC
// 按利用率高低对各区域进行排序，快速识别表现最好和最差的区域

// 车位状态统计
空闲车位分布 = GROUP BY area_code, SUM(available_spaces)
// 统计各区域的空余车位数量分布，为车辆引导提供实时数据

车位使用时长 = AVG(TIMESTAMPDIFF(MINUTE, entry_time, NOW()))
// 计算当前在场车辆的平均停车时长，反映停车需求特征
```

#### **图表类型：**
**1. 热力图**：区域车位使用密度分析

+ **对应数据分析**：`车位利用率`、`区域利用率`、`区域热度`
+ **数据处理逻辑**：  
将停车区域数据转换为热力图坐标点，采用10列网格布局将区域索引转换为X、Y坐标。每个热力图点包含坐标位置、利用率数值、区域名称、已占用车位数和总车位数等信息。建立动态色阶映射机制，利用率低于60%显示蓝色（低负荷），60%-85%显示绿色（正常），85%-95%显示黄色（高负荷），95%以上显示红色（临界状态），直观反映各区域的使用强度。
+ **配置参数**：
    - 颜色映射：0-100%利用率对应蓝-绿-黄-红渐变
    - 网格大小：10x8布局适配大多数停车场
    - 更新频率：1分钟
    - 动画效果：颜色过渡和数值变化动画
+ **交互功能**：悬停显示详细信息，点击查看区域历史，支持时间回放

**2. 环形进度条**：实时利用率监控

+ **对应数据分析**：`车位利用率`、`车位周转率`、`区域饱和度预警`
+ **数据处理逻辑**：  
综合计算利用率指标，包括当前实时利用率（已占用车位除以总车位数乘以100%）、设定目标利用率（通常为85%）、过去24小时内的峰值利用率，以及与昨日同期对比的趋势方向。建立四级预警体系：70%以下为安全状态，70%-90%为繁忙状态，90%-95%为饱和状态，95%以上为溢出状态，为停车场运营管理提供分级预警机制。
+ **配置参数**：
    - 环形粗细：20px
    - 动画时长：1.5秒
    - 目标线：85%利用率目标线
    - 颜色阈值：绿色0-70%，黄色70-90%，红色90%+
+ **交互功能**：显示详细指标，切换不同区域，预测满载时间

**3. 堆叠柱状图**：区域容量与使用情况

+ **对应数据分析**：`区域利用率`、`空闲车位分布`、`车位状态统计`
+ **数据处理逻辑**：  
构建堆叠柱状图数据结构，将每个区域的车位分为已占用、可用、预约和禁用四个类别，并计算利用率百分比。数据按总容量大小降序排列，便于识别大容量区域。同时计算效率指标，包括实际利用效率（已占用除以总数）和资源浪费率（禁用和预约车位除以总数），帮助评估各区域的容量配置合理性和使用效率。
+ **配置参数**：
    - 堆叠顺序：占用-预约-空闲-禁用
    - 颜色方案：红-黄-绿-灰
    - 标签显示：总数和利用率
    - 排序方式：按容量或利用率排序
+ **交互功能**：切换排序方式，显示详细构成，对比历史数据

## 2. 时间维度统计分析
### 2.1 历史趋势分析
#### **使用的接口和字段：**
**3.13 获取时间段范围内的车流量接口**

+ `start_time` - 开始时间
+ `end_time` - 结束时间  
+ `entry_count` - 进场车辆数
+ `exit_count` - 离场车辆数
+ `area_code` - 区域编码

#### **数据分析方法：**
```javascript
// 时段分析
小时车流量 = GROUP BY HOUR(entry_time), COUNT(*)
// 按小时统计进场车辆数量，识别24小时内的流量分布规律

日车流量 = GROUP BY DATE(entry_time), COUNT(*)
// 按天统计车流量，分析日常流量波动和长期变化趋势

高峰时段 = GROUP BY HOUR(entry_time), COUNT(*) ORDER BY COUNT(*) DESC
// 识别车流量最高的时间段，确定停车场的核心服务时间

时段车流量对比 = GROUP BY HOUR(start_time), SUM(entry_count), SUM(exit_count)
// 同时分析进场和离场的时间分布，发现流量不平衡问题

周同比 = (本周车流 - 上周车流) / 上周车流 * 100%
// 计算周度车流增长率，监控短期业务变化趋势

月同比 = (本月车流 - 上月车流) / 上月车流 * 100%

车流趋势预测 = 基于历史数据进行时序分析

峰谷比分析 = MAX(车流量) / MIN(车流量)
// 计算高峰期与低谷期的车流量比值，衡量流量波动程度

区域车流分布 = GROUP BY area_code, SUM(entry_count + exit_count)
// 统计各区域的总车流量，分析空间利用的均衡性
```

#### **图表类型：**
**1. 折线图**：24小时车流趋势监控

+ **对应数据分析**：`小时车流量`、`高峰时段`、`峰谷比分析`
+ **数据处理逻辑**：  
建立24小时车流数据集合，创建包含每小时进场、离场、高峰标识的统计数组。遍历原始数据，根据进场和离场时间的小时值进行分类统计。计算24小时平均流量作为基准线，当某小时的进场量超过平均值1.5倍时标记为高峰时段。
+ **配置参数**：
    - 时间粒度：小时级别，支持切换到15分钟
    - 数据系列：进场、离场、净流量三条线
    - 高峰标记：超出平均值50%的时段高亮
+ **交互功能**：时间区间缩放，高峰时段标注，异常值自动识别

**2. 面积图**：历史趋势累积展示

+ **对应数据分析**：`日车流量`、`周同比`、`月同比`、`车流趋势预测`
+ **数据处理逻辑**：  
建立多时段累积数据处理集合，支持7天、30天、90天等不同时间范围的趋势分析。按指定时间范围对原始记录进行分组，为每个时间段计算累积总量、当日增量、周平均值、增长率和预测值等关键指标。
+ **配置参数**：
    - 堆叠模式：支持累积和百分比堆叠
    - 颜色渐变：从浅到深的蓝色系
    - 时间范围：7天、30天、90天可切换
+ **交互功能**：选择时间段，点击查看单日详情，对比不同时期

**3. 柱状图**：周期性数据对比

+ **对应数据分析**：`时段车流量对比`、`区域车流分布`
+ **数据处理逻辑**：  
建立周期性数据分组对比集合，支持按天（周一至周日）、月（1-12月）、小时（0-23时）三种维度进行数据分组。为每个周期预设标准时间段数组，并创建包含当期数据、前期数据、平均值和增长率的对比结构。
+ **配置参数**：
    - 柱子宽度：自适应容器宽度
    - 颜色编码：正增长绿色，负增长红色
    - 数值标签：显示具体数值和增长率
    - 基准线：显示平均值或目标值
+ **交互功能**：切换分组方式，显示同比环比，异常值突出显示

### 2.2 停车时长分析
#### **使用的接口和字段：**
**3.2 离场数据同步接口**

+ `parking_duration` - 停车时长（分钟）
+ `exit_time` - 离场时间
+ `parking_fee` - 停车费用
+ `plate_number` - 车牌号码
+ `payment_status` - 支付状态

#### **数据分析方法：**
```javascript
// 停车时长分布
平均停车时长 = AVG(parking_duration)
// 计算所有车辆的平均停车时间，反映停车场的主要服务对象特征

停车时长分布 = 
  短停(0-1h): COUNT(parking_duration <= 60)
  // 统计1小时内的短时停车数量
  
  中停(1-4h): COUNT(parking_duration BETWEEN 61 AND 240)
  // 统计1-4小时的中等时长停车
  
  长停(4-8h): COUNT(parking_duration BETWEEN 241 AND 480)
  // 统计4-8小时的长时停车
  
  超长停(>8h): COUNT(parking_duration > 480)
  // 统计超过8小时的超长停车

// 收费统计
收费统计 = SUM(parking_fee), AVG(parking_fee), COUNT(parking_fee > 0)
// 计算总收费金额、平均收费和付费车辆数量

支付状态分析 = GROUP BY payment_status, COUNT(*)
// 统计已付、未付、免费等不同支付状态的车辆数量分布
// 时长与收费关系
停车时长收费分析 = GROUP BY parking_duration范围, AVG(parking_fee)
// 分析不同停车时长区间的平均收费水平，评估收费策略效果
```

#### **图表类型：**
**1. 饼图**：停车时长分布结构分析

+ **对应数据分析**：`停车时长分布`
+ **配置参数**：
    - 颜色方案：蓝-绿-橙-红渐变（时长递增）
    - 标签显示：数量 + 百分比 + 平均收益
    - 动画效果：扇形展开动画
    - 交互模式：点击显示详细分析

**2. 柱状图**：时长区间详细对比

+ **对应数据分析**：`平均停车时长`、`收费统计`
+ **配置参数：**
    - 柱状颜色：基于效率的渐变色（低效红色到高效绿色）
    - 双Y轴：左侧车辆数，右侧收益额
    - 数值标签：显示车辆数和效率评分
    - 基准线：显示平均效率线
+ **交互功能**：切换时间粒度，显示效率排名，异常区间标注

## 3. 异常行为监控
### 3.1 异常行为监控
#### **使用的接口和字段：**
**查询黑名单人员接口**

+ `plate_number` - 车牌号
+ `blacklist_type` - 黑名单类型
+ `blacklist_reason` - 加入原因
+ `add_time` - 加入时间
+ `status` - 状态
+ `park_name` - 车场名称

**7.1 获取欠费车辆信息接口**

+ `plate_number` - 车牌号
+ `debt_amount` - 欠费金额
+ `debt_days` - 欠费天数
+ `last_exit_time` - 最后离场时间
+ `total_amount` - 应付总金额

#### **数据分析方法：**
```javascript
// 异常行为统计
黑名单车辆数 = COUNT(DISTINCT plate_number WHERE blacklist = true)
// 统计当前有效的黑名单车辆总数

欠费车辆数 = COUNT(DISTINCT plate_number WHERE debt_amount > 0)
// 统计存在未结清欠费的车辆数量

超长停车 = COUNT(parking_duration > 48小时)
// 统计停车超过48小时的异常车辆

频繁进出 = COUNT(同一车牌当日进出次数 > 10)
// 识别单日多次进出的异常行为

// 风险等级评估
高风险车辆 = 黑名单 + 欠费 + 超长停车
// 综合多个风险因子评估车辆的风险等级

黑名单类型分布 = GROUP BY blacklist_type, COUNT(*)
// 分析不同类型黑名单的数量分布，识别主要风险来源

欠费金额统计 = SUM(debt_amount), AVG(debt_amount)
// 计算总欠费金额和平均欠费水平，评估财务损失规模

欠费天数分析 = GROUP BY debt_days范围, COUNT(*)
// 按欠费时间长短分析欠费车辆分布，制定不同的催收策略

// 异常趋势分析
黑名单增长趋势 = GROUP BY DATE(add_time), COUNT(*)
// 分析黑名单车辆的增长趋势，评估安全形势变化

欠费车辆增长趋势 = GROUP BY 欠费产生日期, COUNT(*)
// 跟踪欠费车辆的产生趋势，分析收费管理效果变化
```

#### **图表类型：**
**1. 告警面板**：实时异常监控中心

+ **对应数据分析**：`黑名单车辆数`、`欠费车辆数`、`超长停车`、`频繁进出`
+ **数据处理逻辑**：  
建立实时异常监控，设定三级告警机制：紧急级（红色、优先级1、声音提醒）、警告级（黄色、优先级2、无声音）、信息级（蓝色、优先级3、无声音）。对欠费车辆根据金额分级处理（超100元为紧急级），对异常停车统一按警告级处理。维护活跃告警映射表，实现告警去重和优先级排序。
+ **配置参数**：
    - 告警级别：3级颜色区分（红-黄-蓝）
    - 闪烁效果：紧急告警2秒间隔闪烁
    - 自动处理：可配置的自动响应动作

**2. 饼图**：异常类型分布统计

+ **对应数据分析**：`黑名单类型分布`、`欠费金额统计`
+ **数据处理逻辑**：  
建立异常类型统计分析，将异常数据分为黑名单、欠费、超时停车、频繁进出和其他五大类别。对黑名单类别进一步细分子类型并统计各子类数量，对欠费类别累计总金额并计算平均欠费，对超时停车累计总时长并计算平均时长，对频繁进出累计总次数并计算平均次数。遍历异常数据记录，根据类型进行分类统计，最终计算各类别的数量占比。
+ **配置参数**：
    - 颜色方案：红色系渐变强调风险
    - 标签显示：数量+百分比+风险等级

