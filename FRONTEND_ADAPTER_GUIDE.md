# å‰ç«¯æ¥å£é€‚é…æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†å‰ç«¯ä»£ç å¦‚ä½•é€‚é…æ”¹ç‰ˆåçš„åç«¯è®¿å®¢ä¸VIPç»Ÿè®¡åˆ†ææ¥å£ã€‚

---

## ğŸ”„ åç«¯æ¥å£å˜åŒ–

### å˜åŒ–å†…å®¹

åç«¯ä»è°ƒç”¨ACMSæ¥å£æ”¹ä¸ºæŸ¥è¯¢æœ¬åœ°æ•°æ®åº“åï¼š

1. **æ•°æ®æºå˜æ›´**ï¼š`dataSource` ä» `"ACMS"` æ”¹ä¸º `"DATABASE"`
2. **æ— æ•°æ®å¤„ç†**ï¼šå½“æ•°æ®åº“æ— æ•°æ®æ—¶ï¼Œåç«¯è¿”å› `null` è€Œä¸æ˜¯æ¨¡æ‹Ÿæ•°æ®
3. **å­—æ®µä¿æŒå…¼å®¹**ï¼šè¿”å›æ•°æ®çš„å­—æ®µç»“æ„ä¿æŒä¸å˜

### åç«¯è¿”å›æ ¼å¼

#### æœ‰æ•°æ®æ—¶
```json
{
  "code": "0",
  "msg": "success",
  "data": {
    "hourlyData": [...],
    "vipTypes": [...],
    "visitorTypes": [...],
    "summary": {...},
    "dataSource": "DATABASE"
  }
}
```

#### æ— æ•°æ®æ—¶
```json
{
  "code": "0",
  "msg": "success",
  "data": null
}
```

---

## âœ… å‰ç«¯é€‚é…æ–¹æ¡ˆ

### æ ¸å¿ƒç­–ç•¥

**æ™ºèƒ½é™çº§æœºåˆ¶**ï¼šå‰ç«¯è‡ªåŠ¨æ£€æµ‹åç«¯è¿”å›æ•°æ®ï¼Œå½“æ— æœ‰æ•ˆæ•°æ®æ—¶ä½¿ç”¨å‰ç«¯æ¨¡æ‹Ÿæ•°æ®ã€‚

### é€‚é…ä½ç½®

**æ–‡ä»¶ï¼š** `vue-big-screen-master/src/services/visitorVipDataService.js`

---

## ğŸ“ å…·ä½“ä¿®æ”¹

### 1. ç»Ÿè®¡åˆ†ææ¥å£é€‚é…

#### ä¿®æ”¹å‰
```javascript
if (response.data.code === '0' && response.data.data) {
  return this.formatResponseData(response.data.data);
} else {
  console.warn('åç«¯æ¥å£è¿”å›å¼‚å¸¸ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', response.message);
  return this.getMockVisitorVipData(timeRange);
}
```

#### ä¿®æ”¹å
```javascript
console.log('ğŸ“¡ [ç»Ÿè®¡åˆ†æ] åç«¯è¿”å›æ•°æ®:', response.data);

// æ£€æŸ¥è¿”å›æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼ˆåç«¯å¯èƒ½è¿”å›nullæˆ–ç©ºæ•°æ®ï¼‰
if (response.data.code === '0' && response.data.data && 
    response.data.data.hourlyData && response.data.data.hourlyData.length > 0) {
  console.log('âœ… [ç»Ÿè®¡åˆ†æ] ä½¿ç”¨çœŸå®æ•°æ®');
  return this.formatResponseData(response.data.data);
} else {
  console.warn('âš ï¸ [ç»Ÿè®¡åˆ†æ] åç«¯æ— æ•°æ®æˆ–è¿”å›nullï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
  return this.getMockVisitorVipData(timeRange);
}
```

**æ”¹è¿›ç‚¹ï¼š**
- âœ… æ·»åŠ äº†æ›´è¯¦ç»†çš„æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥
- âœ… æ£€æŸ¥ `hourlyData` æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•°æ®
- âœ… æ·»åŠ äº†æ¸…æ™°çš„æ—¥å¿—æ ‡è¯†ï¼ˆğŸ“¡ã€âœ…ã€âš ï¸ï¼‰
- âœ… æ˜ç¡®è¯´æ˜ä½•æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®

---

### 2. è¯¦ç»†ç»Ÿè®¡æ¥å£é€‚é…

#### ä¿®æ”¹å‰
```javascript
console.log('response.data', response.data.data);
if (response.data.code === '0' && response.data.data) {
  return this.formatDetailResponseData(response.data.data);
} else {
  console.warn('åç«¯è¯¦ç»†ç»Ÿè®¡æ¥å£è¿”å›å¼‚å¸¸ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', response.message);
  return this.getMockDetailStatistics(timePoint);
}
```

#### ä¿®æ”¹å
```javascript
console.log('ğŸ“¡ [è¯¦ç»†ç»Ÿè®¡] åç«¯è¿”å›æ•°æ®:', response.data);

// æ£€æŸ¥è¿”å›æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼ˆåç«¯å¯èƒ½è¿”å›nullï¼‰
if (response.data.code === '0' && response.data.data && 
    response.data.data.vipTypes && response.data.data.vipTypes.length > 0) {
  console.log('âœ… [è¯¦ç»†ç»Ÿè®¡] ä½¿ç”¨çœŸå®æ•°æ®');
  return this.formatDetailResponseData(response.data.data);
} else {
  console.warn('âš ï¸ [è¯¦ç»†ç»Ÿè®¡] åç«¯æ— æ•°æ®æˆ–è¿”å›nullï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
  return this.getMockDetailStatistics(timePoint);
}
```

**æ”¹è¿›ç‚¹ï¼š**
- âœ… æ·»åŠ äº† `vipTypes` å’Œ `visitorTypes` æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥
- âœ… æ£€æŸ¥æ•°æ®æ•°ç»„æ˜¯å¦å­˜åœ¨ä¸”æœ‰å†…å®¹
- âœ… æ·»åŠ äº†æ¸…æ™°çš„æ—¥å¿—æ ‡è¯†
- âœ… æä¾›æ›´å‹å¥½çš„è°ƒè¯•ä¿¡æ¯

---

## ğŸ¯ å·¥ä½œæµç¨‹

### æ•°æ®è·å–æµç¨‹

```
å‰ç«¯å‘èµ·è¯·æ±‚
    â†“
åç«¯æŸ¥è¯¢æ•°æ®åº“
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ‰æ•°æ®ï¼Ÿ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“           â†“
   æ˜¯          å¦
    â†“           â†“
è¿”å›çœŸå®æ•°æ®   è¿”å›null
    â†“           â†“
å‰ç«¯æ¥æ”¶å¹¶æ£€æŸ¥æ•°æ®
    â†“           â†“
ä½¿ç”¨çœŸå®æ•°æ®   ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
    â†“           â†“
é¡µé¢æ­£å¸¸æ˜¾ç¤º   é¡µé¢æ­£å¸¸æ˜¾ç¤º
```

### åˆ¤æ–­é€»è¾‘

```javascript
// 1. æ£€æŸ¥å“åº”çŠ¶æ€ç 
response.data.code === '0'

// 2. æ£€æŸ¥dataæ˜¯å¦å­˜åœ¨
response.data.data !== null && response.data.data !== undefined

// 3. æ£€æŸ¥å…³é”®æ•°æ®æ˜¯å¦å­˜åœ¨ä¸”æœ‰å†…å®¹
response.data.data.hourlyData && response.data.data.hourlyData.length > 0
// æˆ–
response.data.data.vipTypes && response.data.data.vipTypes.length > 0
```

---

## ğŸ” è°ƒè¯•ä¿¡æ¯

### æ—¥å¿—æ ‡è¯†è¯´æ˜

| æ ‡è¯† | å«ä¹‰ | è¯´æ˜ |
|-----|------|------|
| ğŸ“¡ | æ¥æ”¶æ•°æ® | åç«¯è¿”å›çš„åŸå§‹æ•°æ® |
| âœ… | ä½¿ç”¨çœŸå®æ•°æ® | æ•°æ®æœ‰æ•ˆï¼Œä½¿ç”¨åç«¯çœŸå®æ•°æ® |
| âš ï¸ | é™çº§ä¸ºæ¨¡æ‹Ÿæ•°æ® | æ•°æ®æ— æ•ˆæˆ–ä¸ºç©ºï¼Œä½¿ç”¨å‰ç«¯æ¨¡æ‹Ÿæ•°æ® |
| âŒ | è¯·æ±‚å¤±è´¥ | ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ |

### ç¤ºä¾‹æ—¥å¿—

#### åœºæ™¯1ï¼šæœ‰çœŸå®æ•°æ®
```
ğŸ“¡ [ç»Ÿè®¡åˆ†æ] åç«¯è¿”å›æ•°æ®: {code: "0", msg: "success", data: {...}}
âœ… [ç»Ÿè®¡åˆ†æ] ä½¿ç”¨çœŸå®æ•°æ®
```

#### åœºæ™¯2ï¼šæ— æ•°æ®ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿï¼‰
```
ğŸ“¡ [ç»Ÿè®¡åˆ†æ] åç«¯è¿”å›æ•°æ®: {code: "0", msg: "success", data: null}
âš ï¸ [ç»Ÿè®¡åˆ†æ] åç«¯æ— æ•°æ®æˆ–è¿”å›nullï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
```

#### åœºæ™¯3ï¼šè¯·æ±‚å¤±è´¥
```
âŒ [ç»Ÿè®¡åˆ†æ] è·å–æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®: TypeError: Failed to fetch
```

---

## ğŸ“Š æ•°æ®æ ¼å¼å¯¹ç…§

### hourlyData æ ¼å¼
```javascript
[
  {
    hour: "08:00",        // æ—¶é—´æ ‡ç­¾
    visitorEntry: 120,    // è®¿å®¢è¿›åœºæ•°
    visitorExit: 100,     // è®¿å®¢ç¦»åœºæ•°
    vipEntry: 45,         // VIPè¿›åœºæ•°
    vipExit: 38           // VIPç¦»åœºæ•°
  },
  // ...
]
```

### vipTypes æ ¼å¼
```javascript
[
  {
    name: "ä¿éšœè½¦è¾†(ä¸å€¼ç­24å°æ—¶å…¨éƒ¨é—¨)",
    value: 68,     // æ€»è®¡ï¼ˆè¿›åœº+ç¦»åœºï¼‰
    entry: 45,     // è¿›åœºæ•°
    exit: 23       // ç¦»åœºæ•°
  },
  // ...
]
```

### visitorTypes æ ¼å¼
```javascript
[
  {
    name: "åŸºå»ºå¤„è½¦è¾†",
    value: 180,    // æ€»è®¡ï¼ˆè¿›åœº+ç¦»åœºï¼‰
    entry: 120,    // è¿›åœºæ•°
    exit: 60       // ç¦»åœºæ•°
  },
  // ...
]
```

---

## ğŸš€ æµ‹è¯•å»ºè®®

### 1. æœ‰æ•°æ®åœºæ™¯æµ‹è¯•
```bash
# ç¡®ä¿æ•°æ®åº“æœ‰æµ‹è¯•æ•°æ®
# è®¿é—®é¡µé¢ï¼Œæ£€æŸ¥ï¼š
- âœ… æ•°æ®æ­£å¸¸æ˜¾ç¤º
- âœ… æ§åˆ¶å°æ˜¾ç¤º "âœ… ä½¿ç”¨çœŸå®æ•°æ®"
- âœ… dataSource ä¸º "DATABASE"
```

### 2. æ— æ•°æ®åœºæ™¯æµ‹è¯•
```bash
# æ¸…ç©ºæ•°æ®åº“æµ‹è¯•æ•°æ®æˆ–ä½¿ç”¨ç©ºæ—¶é—´èŒƒå›´
# è®¿é—®é¡µé¢ï¼Œæ£€æŸ¥ï¼š
- âœ… æ¨¡æ‹Ÿæ•°æ®æ­£å¸¸æ˜¾ç¤º
- âœ… æ§åˆ¶å°æ˜¾ç¤º "âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"
- âœ… é¡µé¢æ— é”™è¯¯ï¼ŒåŠŸèƒ½æ­£å¸¸
```

### 3. ç½‘ç»œé”™è¯¯æµ‹è¯•
```bash
# å…³é—­åç«¯æœåŠ¡æˆ–æ–­ç½‘
# è®¿é—®é¡µé¢ï¼Œæ£€æŸ¥ï¼š
- âœ… æ¨¡æ‹Ÿæ•°æ®æ­£å¸¸æ˜¾ç¤º
- âœ… æ§åˆ¶å°æ˜¾ç¤º "âŒ è¯·æ±‚å¤±è´¥"
- âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½ï¼Œæ— ç™½å±
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®å…¼å®¹æ€§
- åç«¯è¿”å›çš„æ•°æ®ç»“æ„å¿…é¡»ä¸å‰ç«¯æœŸæœ›çš„æ ¼å¼ä¸€è‡´
- æ‰€æœ‰å¿…éœ€å­—æ®µéƒ½åº”è¯¥è¿”å›ï¼ˆå³ä½¿ä¸ºç©ºæ•°ç»„ï¼‰
- å­—æ®µç±»å‹å¿…é¡»æ­£ç¡®ï¼ˆæ•°å­—ä¸èƒ½æ˜¯å­—ç¬¦ä¸²ï¼‰

### 2. æ€§èƒ½è€ƒè™‘
- æ¨¡æ‹Ÿæ•°æ®ä»…åœ¨å¼€å‘å’Œæ— çœŸå®æ•°æ®æ—¶ä½¿ç”¨
- ç”Ÿäº§ç¯å¢ƒåº”ç¡®ä¿æ•°æ®åº“æœ‰æ•°æ®
- é¿å…é¢‘ç¹é™çº§åˆ°æ¨¡æ‹Ÿæ•°æ®

### 3. ç”¨æˆ·ä½“éªŒ
- ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ—¶åº”è¯¥æœ‰æ˜æ˜¾æ ‡è¯†ï¼ˆå¯é€‰ï¼‰
- æ•°æ®ä¸ºç©ºæ—¶å¯ä»¥æ˜¾ç¤ºå‹å¥½æç¤º
- åŠ è½½çŠ¶æ€åº”è¯¥æ¸…æ™°å¯è§

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šé¡µé¢æ˜¾ç¤ºç©ºç™½
**å¯èƒ½åŸå› ï¼š**
- åç«¯è¿”å›æ•°æ®æ ¼å¼é”™è¯¯
- å‰ç«¯æ•°æ®æ ¡éªŒè¿‡äºä¸¥æ ¼
- æ¨¡æ‹Ÿæ•°æ®å‡½æ•°æŠ¥é”™

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—
// ç¡®è®¤æ˜¯å“ªä¸ªé˜¶æ®µå‡ºç°é—®é¢˜

// ä¸´æ—¶è§£å†³ï¼šæ”¾å®½æ•°æ®æ ¡éªŒ
if (response.data.code === '0' && response.data.data) {
  // ç›´æ¥ä½¿ç”¨ï¼Œä¸æ£€æŸ¥å­å­—æ®µ
  return this.formatResponseData(response.data.data);
}
```

### é—®é¢˜2ï¼šä¸€ç›´ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
**å¯èƒ½åŸå› ï¼š**
- æ•°æ®åº“æ— æ•°æ®
- æŸ¥è¯¢æ¡ä»¶ä¸æ­£ç¡®
- æ—¶é—´èŒƒå›´è®¾ç½®æœ‰è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// 1. æ£€æŸ¥åç«¯æ—¥å¿—
// 2. éªŒè¯æ•°æ®åº“æ•°æ®
// 3. ç¡®è®¤æŸ¥è¯¢å‚æ•°
console.log('ğŸ“¡ è¯·æ±‚å‚æ•°:', { parkName, timeRange });
```

### é—®é¢˜3ï¼šæ•°æ®ä¸æ›´æ–°
**å¯èƒ½åŸå› ï¼š**
- ç¼“å­˜é—®é¢˜
- è‡ªåŠ¨åˆ·æ–°å¤±æ•ˆ
- WebSocketè¿æ¥æ–­å¼€

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// å¼ºåˆ¶åˆ·æ–°
this.loadData();

// æˆ–é‡å¯è‡ªåŠ¨åˆ·æ–°
this.stopAutoRefresh();
this.startAutoRefresh();
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. [åç«¯é‡æ„æ–‡æ¡£](../../boot/VISITOR_VIP_ANALYSIS_REFACTOR_SUMMARY.md)
2. [APIæ¥å£æ–‡æ¡£](../../boot/VISITOR_VIP_ANALYSIS_REFACTOR_SUMMARY.md#-apiæ¥å£)
3. [å¿«é€Ÿæµ‹è¯•æŒ‡å—](../../boot/QUICK_TEST_GUIDE.md)

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ•°æ®æ ¡éªŒ
```javascript
// å¥½çš„åšæ³•ï¼šå®Œæ•´çš„æ•°æ®æ ¡éªŒ
if (response.data.code === '0' && 
    response.data.data && 
    Array.isArray(response.data.data.hourlyData) &&
    response.data.data.hourlyData.length > 0) {
  // ä½¿ç”¨çœŸå®æ•°æ®
}
```

### 2. é”™è¯¯å¤„ç†
```javascript
// å¥½çš„åšæ³•ï¼šåˆ†å±‚é”™è¯¯å¤„ç†
try {
  const response = await this.request(...);
  if (isValidData(response)) {
    return formatData(response);
  } else {
    return getMockData();
  }
} catch (error) {
  console.error('è¯·æ±‚å¤±è´¥:', error);
  return getMockData(); // é™çº§æ–¹æ¡ˆ
}
```

### 3. æ—¥å¿—è®°å½•
```javascript
// å¥½çš„åšæ³•ï¼šæ¸…æ™°çš„æ—¥å¿—æ ‡è¯†
console.log('ğŸ“¡ [æ¨¡å—] åŠ¨ä½œ:', data);
console.log('âœ… [æ¨¡å—] æˆåŠŸ:', result);
console.warn('âš ï¸ [æ¨¡å—] è­¦å‘Š:', warning);
console.error('âŒ [æ¨¡å—] é”™è¯¯:', error);
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0.0  
**æœ€åæ›´æ–°ï¼š** 2024å¹´10æœˆ25æ—¥  
**ç»´æŠ¤äººå‘˜ï¼š** å‰ç«¯å¼€å‘å›¢é˜Ÿ

