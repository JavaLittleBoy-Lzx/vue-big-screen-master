# 后端API集成说明

## 概述

前端页面已经集成了后端API调用，可以通过调用后端的`reportCarIn`和`reportCarOut`接口来获取真实的车辆进出场数据。

## 后端接口说明

### 1. 车辆预约查询接口
- **接口路径**: `/parking/nefuData/page`
- **请求方法**: GET
- **功能**: 获取车辆预约记录，用于显示车辆进出场列表

### 2. 在场车辆查询接口
- **接口路径**: `/parking/nefuData/getParkOnSiteCar`
- **请求方法**: GET
- **功能**: 获取当前在场车辆信息

### 3. 进场记录查询接口
- **接口路径**: `/parking/nefuData/getCarInList`
- **请求方法**: POST
- **功能**: 获取指定时间段的进场记录

### 4. 数据上报接口
- **接口路径**: `/parking/nefuData/reportCarIn` 和 `/parking/nefuData/reportCarOut`
- **请求方法**: POST
- **功能**: 接收车辆进出场数据上报

## 前端配置

### 1. API配置文件
文件位置: `src/config/apiConfig.js`

```javascript
export const API_CONFIG = {
  BACKEND_URL: 'http://localhost:6954',  // 后端服务器地址
  API_PREFIX: '/parking/nefuData',       // API前缀
  TIMEOUT: 10000,                        // 请求超时时间
  // ... 其他配置
};
```

### 2. 车辆数据服务
文件位置: `src/services/vehicleDataService.js`

该服务负责：
- 调用后端API获取车辆数据
- 数据格式转换
- 错误处理和降级方案
- 模拟数据生成（当API不可用时）

### 3. 前端页面集成
文件位置: `src/views/center.vue`

主要修改：
- 导入车辆数据服务
- 修改初始化方法为异步调用API
- 更新数据生成逻辑
- 添加实时数据更新

## 数据流程

1. **初始化阶段**:
   - 页面加载时调用`initVehicleRecords()`
   - 从API获取初始车辆记录
   - 如果API失败，使用模拟数据

2. **实时更新**:
   - 每8秒调用API获取新的车辆记录
   - 每10秒更新实时流量数据
   - 保持数据的新鲜度

3. **数据转换**:
   - API返回的数据会被转换为前端需要的格式
   - 车牌号长度判断车辆类型（7位=油车，8位=新能源）
   - 时间格式标准化

## 环境配置

### 开发环境
```bash
# 设置后端API地址
export VUE_APP_BACKEND_URL=http://localhost:6954
```

### 生产环境
```bash
# 设置生产环境后端地址
export VUE_APP_BACKEND_URL=http://your-production-server:6954
```

## 错误处理

1. **API调用失败**: 自动降级到模拟数据
2. **网络超时**: 使用缓存数据或模拟数据
3. **数据格式错误**: 记录错误日志，使用默认值

## 车辆类型判断

系统根据车牌号长度自动判断车辆类型：
- **7位车牌**: 传统燃油车（油车）
- **8位车牌**: 新能源车（绿牌）

## 数据更新频率

- **车辆记录**: 每8秒更新一次
- **实时流量**: 每10秒更新一次
- **人脸记录**: 保持原有模拟数据（2-6秒随机）

## 注意事项

1. 确保后端服务正常运行
2. 检查CORS配置，允许前端域名访问
3. 监控API响应时间，避免影响用户体验
4. 定期检查数据格式是否与后端一致

## 调试方法

1. 打开浏览器开发者工具
2. 查看Network标签页的API请求
3. 检查Console中的错误日志
4. 验证数据格式是否正确

## 扩展功能

如需添加更多API接口，可以：
1. 在`vehicleDataService.js`中添加新方法
2. 在`center.vue`中调用新方法
3. 更新数据更新逻辑

## 故障排除

### 常见问题

1. **API调用失败**
   - 检查后端服务是否启动
   - 验证API地址是否正确
   - 检查网络连接

2. **数据显示异常**
   - 检查数据格式转换逻辑
   - 验证车牌号长度判断
   - 查看控制台错误信息

3. **性能问题**
   - 调整更新频率
   - 优化数据量
   - 检查缓存配置
